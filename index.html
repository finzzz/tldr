<!DOCTYPE html>
<html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="stylesheet" href="monokai.css">
    <style type="text/css">
        body {
            background:#f3f5fa;
            color:#4a4e69;
            font-family: "Source Sans Pro", Helvetica, Arial, sans-serif;
            line-height: 1.5;
        }

        code.hljs { 
            display: inline; 
        }

        #os {
            height: 1.8rem;
            padding: 1px 0px;
        }

        #command {
            height: 1.55rem;
            width: 20%;
            border-color: #fff;
            border: 1px solid #ced4da;
            margin-left: 5px;
            padding-left: 0.75rem;
        }

        #search_btn {
            color: #fff;
            background-color: #6c757d;
            border-color: #6c757d;
            border: 1px solid transparent;
            border-radius: .25rem;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            height: 1.8rem;
            width: 30px;
            margin-left: -1px;
        }

        #content {
            padding-left:5%;
            padding-right:5%;
        }
    </style>
    <title>TLDR Web Client by finzzz</title>
</head>
<body>
    <div align=center>
        <h1>TLDR Web Client by finzzz</h1>
        <select id="os" onchange="changeContent('command');">
            <option value="common">Common</option>
            <option value="linux">Linux</option>
            <option value="osx">OSX</option>
            <option value="sunos">Sun OS</option>
            <option value="windows">Windows</option>
        </select>
        <input type="text" id="command"/><button id=search_btn onclick="search()">></button> 
    </div>
    <div id="content"></div>

    <script src="highlight.min.js"></script> <!-- https://highlightjs.org -->
    <script src="marked.min.js"></script> <!-- https://github.com/markedjs/marked -->
    <script>
        // clear on refresh
        document.getElementById("os").selectedIndex = 0;
        document.getElementById('command').value = ""

        function search(){
            var path = "tldr/pages/"
            var subfolders = document.getElementById("os").value
            var command = document.getElementById("command").value
            var url = path + subfolders + "/" + command + ".md"

            localStorage.setItem("command", command)

            fetch(url)
            .then((resp)=>{
                if (resp.status != "404"){
                    get(url)                    
                }else{
                    document.getElementById('content').innerHTML = marked("# Not Found")
                }
            })
        }

        function get(url){
            fetch(url)
            .then((resp)=>{return resp.text()})
            .then((text)=>{
                document.getElementById('content').innerHTML = marked(text)
                document.querySelectorAll('code').forEach((block) => { 
                    hljs.configure({
                        tabReplace: '    ',
                        languages: ["bash", "shell"],
                    })
                    hljs.highlightBlock(block) 
                })
            })
            
        }

        function getSavedValue(v){
            if (!localStorage.getItem(v)) {
                return ""
            }
            return localStorage.getItem(v)
        }

        function changeContent(id){
            document.getElementById(id).innerHTML = getSavedValue(id)
        }

        // trigger on enter
        document.getElementById("command")
        .addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault()
                document.getElementById("search_btn").click()
            }
        })
    </script>
</body>
</html>
